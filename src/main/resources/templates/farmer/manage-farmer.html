<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>智农通农产品交易平台 - 农户中心</title>
    <!-- 引入 Element UI 样式 -->
    <link rel="stylesheet" href="/static/element-ui/theme-chalk/index.css">
    <!-- 引入 Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入高德地图API -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=您的高德地图key"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            line-height: 1.6;
        }
        .el-header {
            background-color: white;
            color: #333;
            line-height: 60px;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo {
            display: flex;
            align-items: center;
        }
        .logo-icon {
            font-size: 32px;
            color: #2e7d32;
            margin-right: 10px;
        }
        .logo-text {
            font-size: 20px;
            font-weight: bold;
            color: #2e7d32;
        }
        nav ul {
            display: flex;
            list-style: none;
        }
        nav ul li {
            margin-left: 25px;
        }
        nav ul li a {
            text-decoration: none;
            color: #4a4a4a;
            font-weight: 500;
            font-size: 16px;
            transition: color 0.3s;
        }
        nav ul li a:hover {
            color: #2e7d32;
        }
        .el-aside {
            background-color: #f5f7fa;
            height: calc(100vh - 60px);
            overflow-y: auto;
            padding-top: 20px;
        }
        .content-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin: 20px;
        }
        .el-footer {
            background: linear-gradient(to right, #1b5e20, #2e7d32);
            color: white;
            text-align: center;
            line-height: 60px;
        }
        /* 按钮样式 */
        .el-button {
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .el-button:hover {
            background-color: #1b5e20;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(46, 125, 50, 0.4);
        }
        /* 表单输入框样式 */
        .el-input__inner {
            background-color: #f5f7fa;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
        }
        /* 按钮组样式 */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;
        }
        .button-group .el-button {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            .el-header {
                flex-direction: column;
                text-align: center;
            }
            nav ul {
                margin-top: 10px;
                justify-content: center;
            }
        }
        /* 物流详情页面样式 */
        .logistics-detail-container {
            padding: 20px;
        }
        .logistics-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .logistics-info {
            display: flex;
            margin-bottom: 20px;
        }
        .logistics-company {
            flex: 1;
            padding-right: 20px;
        }
        .logistics-number {
            flex: 1;
        }
        .logistics-status {
            color: #2e7d32;
            font-weight: bold;
        }
        .logistics-timeline {
            margin: 30px 0;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
            padding-left: 30px;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            left: 6px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #2e7d32;
        }
        .timeline-item:after {
            content: '';
            position: absolute;
            left: 11px;
            top: 12px;
            width: 2px;
            height: 100%;
            background-color: #e0e0e0;
        }
        .timeline-item:last-child:after {
            display: none;
        }
        .timeline-time {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }
        .timeline-content {
            font-size: 16px;
        }
        .logistics-map-container {
            margin-top: 40px;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }
        .logistics-map-title {
            padding: 15px;
            background-color: #f5f7fa;
            border-bottom: 1px solid #eee;
            font-weight: bold;
        }
        /* 地图容器样式 */
        #map-container {
            height: 400px;
            width: 100%;
        }
        .back-button {
            margin-bottom: 20px;
        }
        /* 商品图片样式 */
        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }
        /* 表单弹窗样式 */
        .form-dialog {
            padding: 20px;
        }
        /* 状态标签样式 */
        .status-tag {
            margin-right: 5px;
        }
    </style>
</head>
<body>
<div id="app">
    <el-container style="height: 100vh;">
        <!-- 头部 -->
        <el-header class="el-header">
            <div class="logo">
                <i class="fas fa-leaf logo-icon"></i>
                <div>
                    <div class="logo-text">智农通 - 农户中心</div>
                </div>
            </div>
            <nav>
                <ul>
                    <li><a href="#"><i class="fas fa-home"></i> 首页</a></li>
                    <li><a href="#"><i class="fas fa-apple-alt"></i> 农产品市场</a></li>
                    <li><a href="#"><i class="fas fa-chart-line"></i> 数据分析</a></li>
                    <li><a href="#"><i class="fas fa-info-circle"></i> 帮助中心</a></li>
                    <li><a href="#"><i class="fas fa-phone"></i> 联系我们</a></li>
                </ul>
            </nav>
        </el-header>
        <!-- 主体容器 -->
        <el-container>
            <!-- 左侧菜单 - 农户特有功能 -->
            <el-aside width="220px" class="el-aside">
                <el-menu default-active="my-products" class="el-menu-vertical-demo" @select="handleMenuSelect">
                    <el-submenu index="1">
                        <template slot="title"><i class="el-icon-goods"></i> 商品管理</template>
                        <el-menu-item index="my-products">我的商品</el-menu-item>
                        <el-menu-item index="published-products">已发布商品</el-menu-item>

                    </el-submenu>
                    <el-submenu index="2">
                        <template slot="title"><i class="el-icon-tickets"></i> 订单管理</template>
                        <el-menu-item index="all-orders">全部订单</el-menu-item>
                        <el-menu-item index="pending-orders">待处理订单</el-menu-item>
                        <el-menu-item index="completed-orders">已完成订单</el-menu-item>
                    </el-submenu>
                    <el-submenu index="3">
                        <template slot="title"><i class="el-icon-truck"></i> 物流管理</template>
                        <el-menu-item index="to-ship">待发货</el-menu-item>
                        <el-menu-item index="shipped">已发货</el-menu-item>
                        <el-menu-item index="delivered">已签收</el-menu-item>
                    </el-submenu>
                    <el-menu-item index="farmer-info"><i class="el-icon-user"></i> 农户信息</el-menu-item>
                    <el-menu-item index="finance"><i class="el-icon-money"></i> 财务统计</el-menu-item>
                </el-menu>
            </el-aside>
            <!-- 右侧内容区域 -->
            <el-main class="content-box">
                <!-- 动态加载的组件 -->
                <component :is="currentComponent"
                           @view-logistics="showLogisticsDetail"
                           @edit-product="showEditProductDialog"
                           @add-product="showAddProductDialog"></component>

                <!-- 物流详情组件 -->
                <logistics-detail v-if="showLogisticsDetail"
                                  :logistics-data="currentLogistics"
                                  @back="hideLogisticsDetail"></logistics-detail>

                <!-- 添加商品对话框 -->
                <el-dialog title="发布新商品" :visible.sync="showAddProductDialogVisible" width="50%">
                    <div class="form-dialog">
                        <el-form :model="newProductForm" :rules="productRules" ref="newProductForm" label-width="100px">
                            <el-form-item label="商品名称" prop="name">
                                <el-input v-model="newProductForm.name" placeholder="请输入商品名称"></el-input>
                            </el-form-item>
                            <el-form-item label="商品分类" prop="category">
                                <el-select v-model="newProductForm.category" placeholder="请选择商品分类">
                                    <el-option label="蔬菜" value="vegetable"></el-option>
                                    <el-option label="水果" value="fruit"></el-option>
                                    <el-option label="谷物" value="grain"></el-option>
                                    <el-option label="禽蛋" value="egg"></el-option>
                                    <el-option label="肉类" value="meat"></el-option>
                                    <el-option label="水产" value="aquatic"></el-option>
                                    <el-option label="其他" value="other"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="商品价格" prop="price">
                                <el-input-number v-model="newProductForm.price" :min="0" :precision="2" :step="0.1"></el-input-number>
                            </el-form-item>
                            <el-form-item label="库存数量" prop="stock">
                                <el-input-number v-model="newProductForm.stock" :min="0"></el-input-number>
                            </el-form-item>
                            <el-form-item label="计量单位" prop="unit">
                                <el-input v-model="newProductForm.unit" placeholder="如：斤、公斤、个等"></el-input>
                            </el-form-item>
                            <el-form-item label="商品图片" prop="image">
                                <el-upload
                                        action="https://jsonplaceholder.typicode.com/posts/"
                                        list-type="picture-card"
                                        :on-preview="handlePictureCardPreview"
                                        :on-remove="handleRemove">
                                    <i class="el-icon-plus"></i>
                                </el-upload>
                                <el-dialog :visible.sync="dialogVisible">
                                    <img width="100%" :src="dialogImageUrl" alt="">
                                </el-dialog>
                            </el-form-item>
                            <el-form-item label="商品描述" prop="description">
                                <el-input type="textarea" v-model="newProductForm.description" :rows="4" placeholder="请输入商品详细描述"></el-input>
                            </el-form-item>
                            <el-form-item label="产地信息" prop="origin">
                                <el-input v-model="newProductForm.origin" placeholder="请输入商品产地"></el-input>
                            </el-form-item>
                            <el-form-item label="保质期" prop="shelfLife">
                                <el-input v-model="newProductForm.shelfLife" placeholder="如：7天、1个月等"></el-input>
                            </el-form-item>
                        </el-form>
                    </div>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="showAddProductDialogVisible = false">取 消</el-button>
                        <el-button type="primary" @click="submitNewProduct">确 定</el-button>
                    </span>
                </el-dialog>

                <!-- 编辑商品对话框 -->
                <el-dialog title="编辑商品信息" :visible.sync="showEditProductDialogVisible" width="50%">
                    <div class="form-dialog">
                        <el-form :model="editProductForm" :rules="productRules" ref="editProductForm" label-width="100px">
                            <el-form-item label="商品名称" prop="name">
                                <el-input v-model="editProductForm.name"></el-input>
                            </el-form-item>
                            <el-form-item label="商品分类" prop="category">
                                <el-select v-model="editProductForm.category">
                                    <el-option label="蔬菜" value="vegetable"></el-option>
                                    <el-option label="水果" value="fruit"></el-option>
                                    <el-option label="谷物" value="grain"></el-option>
                                    <el-option label="禽蛋" value="egg"></el-option>
                                    <el-option label="肉类" value="meat"></el-option>
                                    <el-option label="水产" value="aquatic"></el-option>
                                    <el-option label="其他" value="other"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="商品价格" prop="price">
                                <el-input-number v-model="editProductForm.price" :min="0" :precision="2" :step="0.1"></el-input-number>
                            </el-form-item>
                            <el-form-item label="库存数量" prop="stock">
                                <el-input-number v-model="editProductForm.stock" :min="0"></el-input-number>
                            </el-form-item>
                            <el-form-item label="计量单位" prop="unit">
                                <el-input v-model="editProductForm.unit"></el-input>
                            </el-form-item>
                            <el-form-item label="商品图片" prop="image">
                                <el-upload
                                        action="https://jsonplaceholder.typicode.com/posts/"
                                        list-type="picture-card"
                                        :on-preview="handlePictureCardPreview"
                                        :on-remove="handleRemove">
                                    <i class="el-icon-plus"></i>
                                </el-upload>
                                <el-dialog :visible.sync="dialogVisible">
                                    <img width="100%" :src="dialogImageUrl" alt="">
                                </el-dialog>
                            </el-form-item>
                            <el-form-item label="商品描述" prop="description">
                                <el-input type="textarea" v-model="editProductForm.description" :rows="4"></el-input>
                            </el-form-item>
                            <el-form-item label="产地信息" prop="origin">
                                <el-input v-model="editProductForm.origin"></el-input>
                            </el-form-item>
                            <el-form-item label="保质期" prop="shelfLife">
                                <el-input v-model="editProductForm.shelfLife"></el-input>
                            </el-form-item>
                        </el-form>
                    </div>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="showEditProductDialogVisible = false">取 消</el-button>
                        <el-button type="primary" @click="submitEditProduct">确 定</el-button>
                    </span>
                </el-dialog>
            </el-main>
        </el-container>
        <!-- 底部 -->
        <el-footer class="el-footer">
            © 2025 智农通农产品交易平台 版权所有
        </el-footer>
    </el-container>
</div>

<!-- 引入 Vue 和 Element UI -->
<script src="/static/js/vue.min.js"></script>
<script src="/static/element-ui/index.js"></script>

<!-- 组件定义 -->
<script>
    // 我的商品组件
    const MyProducts = {
        template: `
          <div>
            <h2>我的商品</h2>
            <div class="button-group">
              <el-button type="primary" icon="el-icon-plus" @click="$emit('add-product')">发布新商品</el-button>
              <el-button type="info" icon="el-icon-refresh">刷新列表</el-button>
            </div>
            <el-table :data="products" style="width: 100%" border>
              <el-table-column prop="id" label="ID" width="80"></el-table-column>
              <el-table-column label="商品图片" width="120">
                <template slot-scope="scope">
                  <img :src="scope.row.image" class="product-image" alt="商品图片">
                </template>
              </el-table-column>
              <el-table-column prop="name" label="商品名称"></el-table-column>
              <el-table-column prop="category" label="分类" width="120">
                <template slot-scope="scope">
                  <el-tag :type="getCategoryTagType(scope.row.category)">{{ scope.row.category | formatCategory }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column label="价格/库存" width="150">
                <template slot-scope="scope">
                  <div>¥ {{ scope.row.price }} / {{ scope.row.stock }}{{ scope.row.unit }}</div>
                </template>
              </el-table-column>
              <el-table-column prop="status" label="状态" width="120">
                <template slot-scope="scope">
                  <el-tag :type="getStatusTagType(scope.row.status)" class="status-tag">{{ scope.row.status }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column label="操作" width="200">
                <template slot-scope="scope">
                  <div class="button-group">
                    <el-button size="small" type="primary" @click="$emit('edit-product', scope.row)">编辑</el-button>
                    <el-button size="small" type="success" v-if="scope.row.status === '下架'" @click="shelveProduct(scope.row)">上架</el-button>
                    <el-button size="small" type="warning" v-if="scope.row.status === '上架'" @click="unshelveProduct(scope.row)">下架</el-button>
                    <el-button size="small" type="danger" @click="deleteProduct(scope.row)">删除</el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="products.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                products: [
                    { id: 'p001', name: '有机西红柿', category: 'vegetable', price: 12.8, stock: 50, unit: '斤',
                        image: '/static/img/tomato.png', status: '上架', description: '新鲜有机西红柿，无农药残留', origin: '山东寿光', shelfLife: '7天' },
                    { id: 'p002', name: '红富士苹果', category: 'fruit', price: 8.5, stock: 100, unit: '斤',
                        image: '/static/img/apple.png', status: '上架', description: '烟台红富士苹果，甜脆多汁', origin: '山东烟台', shelfLife: '30天' },
                    { id: 'p003', name: '农家土鸡蛋', category: 'egg', price: 1.5, stock: 200, unit: '个',
                        image: '/static/img/egg.png', status: '上架', description: '散养土鸡蛋，营养丰富', origin: '河北张家口', shelfLife: '15天' },
                    { id: 'p004', name: '五常大米', category: 'grain', price: 89.9, stock: 30, unit: '袋',
                        image: '/static/img/rice.png', status: '下架', description: '正宗五常大米，10kg/袋', origin: '黑龙江五常', shelfLife: '12个月' },
                    { id: 'p005', name: '新鲜菠菜', category: 'vegetable', price: 6.5, stock: 80, unit: '斤',
                        image: '/static/img/spinach.png', status: '上架', description: '新鲜菠菜，现摘现发', origin: '北京郊区', shelfLife: '5天' }
                ]
            };
        },
        filters: {
            formatCategory(value) {
                const map = {
                    'vegetable': '蔬菜',
                    'fruit': '水果',
                    'grain': '谷物',
                    'egg': '禽蛋',
                    'meat': '肉类',
                    'aquatic': '水产',
                    'other': '其他'
                };
                return map[value] || value;
            }
        },
        methods: {
            getCategoryTagType(category) {
                const types = {
                    'vegetable': 'success',
                    'fruit': 'warning',
                    'grain': '',
                    'egg': 'info',
                    'meat': 'danger',
                    'aquatic': 'primary',
                    'other': 'info'
                };
                return types[category] || '';
            },
            getStatusTagType(status) {
                return status === '上架' ? 'success' : 'warning';
            },
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            shelveProduct(product) {
                this.$confirm('确定要上架该商品吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    product.status = '上架';
                    this.$message.success('商品已上架');
                }).catch(() => {});
            },
            unshelveProduct(product) {
                this.$confirm('确定要下架该商品吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    product.status = '下架';
                    this.$message.success('商品已下架');
                }).catch(() => {});
            },
            deleteProduct(product) {
                this.$confirm('确定要删除该商品吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    this.products = this.products.filter(p => p.id !== product.id);
                    this.$message.success('商品已删除');
                }).catch(() => {});
            }
        }
    };

    // 已发布商品组件
    const PublishedProducts = {
        template: `
          <div>
            <h2>已发布商品</h2>
            <div class="button-group">
              <el-button type="primary" icon="el-icon-search">搜索商品</el-button>
              <el-button type="info" icon="el-icon-refresh">刷新列表</el-button>
            </div>
            <el-table :data="publishedProducts" style="width: 100%" border>
              <el-table-column prop="id" label="ID" width="80"></el-table-column>
              <el-table-column label="商品图片" width="120">
                <template slot-scope="scope">
                  <img :src="scope.row.image" class="product-image" alt="商品图片">
                </template>
              </el-table-column>
              <el-table-column prop="name" label="商品名称"></el-table-column>
              <el-table-column prop="category" label="分类" width="120">
                <template slot-scope="scope">
                  <el-tag :type="getCategoryTagType(scope.row.category)">{{ scope.row.category | formatCategory }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column label="价格/销量" width="150">
                <template slot-scope="scope">
                  <div>¥ {{ scope.row.price }} / 销量: {{ scope.row.sales }}</div>
                </template>
              </el-table-column>
              <el-table-column label="评价" width="120">
                <template slot-scope="scope">
                  <el-rate v-model="scope.row.rating" disabled show-score text-color="#ff9900" score-template="{value}"></el-rate>
                </template>
              </el-table-column>
              <el-table-column label="操作" width="180">
                <template slot-scope="scope">
                  <div class="button-group">
                    <el-button size="small" type="primary" @click="viewDetails(scope.row)">详情</el-button>
                    <el-button size="small" type="warning" @click="$emit('edit-product', scope.row)">编辑</el-button>
                    <el-button size="small" type="danger" @click="unshelveProduct(scope.row)">下架</el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="publishedProducts.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                publishedProducts: [
                    { id: 'p001', name: '有机西红柿', category: 'vegetable', price: 12.8, sales: 156,
                        image: '/static/img/tomato.png', rating: 4.7, description: '新鲜有机西红柿，无农药残留', origin: '山东寿光' },
                    { id: 'p002', name: '红富士苹果', category: 'fruit', price: 8.5, sales: 289,
                        image: '/static/img/apple.png', rating: 4.9, description: '烟台红富士苹果，甜脆多汁', origin: '山东烟台' },
                    { id: 'p003', name: '农家土鸡蛋', category: 'egg', price: 1.5, sales: 432,
                        image: '/static/img/egg.png', rating: 4.8, description: '散养土鸡蛋，营养丰富', origin: '河北张家口' },
                    { id: 'p005', name: '新鲜菠菜', category: 'vegetable', price: 6.5, sales: 98,
                        image: '/static/img/spinach.png', rating: 4.5, description: '新鲜菠菜，现摘现发', origin: '北京郊区' }
                ]
            };
        },
        filters: {
            formatCategory(value) {
                const map = {
                    'vegetable': '蔬菜',
                    'fruit': '水果',
                    'grain': '谷物',
                    'egg': '禽蛋',
                    'meat': '肉类',
                    'aquatic': '水产',
                    'other': '其他'
                };
                return map[value] || value;
            }
        },
        methods: {
            getCategoryTagType(category) {
                const types = {
                    'vegetable': 'success',
                    'fruit': 'warning',
                    'grain': '',
                    'egg': 'info',
                    'meat': 'danger',
                    'aquatic': 'primary',
                    'other': 'info'
                };
                return types[category] || '';
            },
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewDetails(product) {
                this.$alert(`<div>
                    <p><strong>商品名称：</strong>${product.name}</p>
                    <p><strong>商品分类：</strong>${this.$options.filters.formatCategory(product.category)}</p>
                    <p><strong>商品价格：</strong>¥${product.price}</p>
                    <p><strong>累计销量：</strong>${product.sales}</p>
                    <p><strong>商品描述：</strong>${product.description}</p>
                    <p><strong>商品产地：</strong>${product.origin}</p>
                </div>`, '商品详情', {
                    dangerouslyUseHTMLString: true,
                    customClass: 'product-detail-alert'
                });
            },
            unshelveProduct(product) {
                this.$confirm('确定要下架该商品吗？下架后将不再展示在平台', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    this.publishedProducts = this.publishedProducts.filter(p => p.id !== product.id);
                    this.$message.success('商品已下架');
                }).catch(() => {});
            }
        }
    };

    // 全部订单组件
    const AllOrders = {
        template: `
          <div>
            <h2>全部订单</h2>
            <div class="button-group">
              <el-button type="primary" icon="el-icon-search">搜索订单</el-button>
              <el-button type="info" icon="el-icon-refresh">刷新列表</el-button>
              <el-date-picker
                  v-model="dateRange"
                  type="daterange"
                  align="right"
                  unlink-panels
                  range-separator="至"
                  start-placeholder="开始日期"
                  end-placeholder="结束日期"
                  :picker-options="pickerOptions">
              </el-date-picker>
            </div>
            <el-table :data="orders" style="width: 100%" border>
              <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
              <el-table-column label="商品信息" width="300">
                <template slot-scope="scope">
                  <div v-for="(product, index) in scope.row.products" :key="index" style="margin-bottom: 5px;">
                    <img :src="product.image" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; float: left; margin-right: 10px;">
                    <div style="float: left;">
                      <div>{{ product.name }}</div>
                      <div style="font-size: 12px; color: #999;">¥ {{ product.price }} × {{ product.quantity }}</div>
                    </div>
                    <div style="clear: both;"></div>
                  </div>
                </template>
              </el-table-column>
              <el-table-column label="订单金额" width="120">
                <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
              </el-table-column>
              <el-table-column label="买家信息" width="150">
                <template slot-scope="scope">
                  <div>{{ scope.row.buyer }}</div>
                  <div style="font-size: 12px; color: #999;">{{ scope.row.buyerPhone }}</div>
                </template>
              </el-table-column>
              <el-table-column label="订单状态" width="120">
                <template slot-scope="scope">
                  <el-tag :type="getStatusTagType(scope.row.status)">{{ scope.row.status }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column label="下单时间" width="180">
                <template slot-scope="scope">{{ scope.row.createTime }}</template>
              </el-table-column>
              <el-table-column label="操作" width="180">
                <template slot-scope="scope">
                  <div class="button-group">
                    <el-button size="small" type="primary" @click="viewOrder(scope.row)">详情</el-button>
                    <el-button size="small" type="success" v-if="scope.row.status === '待发货'" @click="shipOrder(scope.row)">发货</el-button>
                    <el-button size="small" type="info" v-if="scope.row.status === '已发货'" @click="viewLogistics(scope.row)">物流</el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="orders.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                dateRange: [],
                pickerOptions: {
                    shortcuts: [{
                        text: '最近一周',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近一个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近三个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                            picker.$emit('pick', [start, end]);
                        }
                    }]
                },
                orders: [
                    {
                        orderNumber: '20250615001',
                        products: [
                            { name: '有机西红柿', price: 12.8, quantity: 2, image: '/static/img/tomato.png' },
                            { name: '新鲜菠菜', price: 6.5, quantity: 1, image: '/static/img/spinach.png' }
                        ],
                        totalPrice: 32.1,
                        buyer: '张先生',
                        buyerPhone: '138****1234',
                        status: '待发货',
                        createTime: '2025-06-15 10:30:22',
                        logisticsInfo: {
                            expressCompany: '',
                            expressNumber: '',
                            status: '待发货',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '上海市浦东新区张江高科技园区科苑路88号',
                            timeline: []
                        }
                    },
                    {
                        orderNumber: '20250614002',
                        products: [
                            { name: '红富士苹果', price: 8.5, quantity: 5, image: '/static/img/apple.png' }
                        ],
                        totalPrice: 42.5,
                        buyer: '李女士',
                        buyerPhone: '139****5678',
                        status: '已发货',
                        createTime: '2025-06-14 15:45:11',
                        logisticsInfo: {
                            expressCompany: '顺丰速运',
                            expressNumber: 'SF1234567890123',
                            status: '运输中',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '北京市海淀区中关村南大街5号',
                            expectDate: '2025-06-18',
                            timeline: [
                                { time: '2025-06-14 16:30:00', status: '已揽收', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-14 18:15:00', status: '已发往北京中转中心', location: '杭州', lnglat: [120.15507, 30.274085] }
                            ]
                        }
                    },
                    {
                        orderNumber: '20250612003',
                        products: [
                            { name: '农家土鸡蛋', price: 1.5, quantity: 30, image: '/static/img/egg.png' },
                            { name: '五常大米', price: 89.9, quantity: 1, image: '/static/img/rice.png' }
                        ],
                        totalPrice: 134.9,
                        buyer: '王先生',
                        buyerPhone: '137****9012',
                        status: '已完成',
                        createTime: '2025-06-12 09:20:35',
                        logisticsInfo: {
                            expressCompany: '中通快递',
                            expressNumber: 'ZT1234567890123',
                            status: '已签收',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '广东省深圳市南山区科技园路1号',
                            timeline: [
                                { time: '2025-06-12 10:15:00', status: '已揽收', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-12 15:45:00', status: '已发往深圳中转中心', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-13 09:20:00', status: '到达深圳中转中心', location: '深圳', lnglat: [114.057868, 22.543099] },
                                { time: '2025-06-13 14:10:00', status: '派送中', location: '深圳', lnglat: [114.057868, 22.543099] },
                                { time: '2025-06-13 16:30:00', status: '已签收', location: '深圳', lnglat: [114.057868, 22.543099] }
                            ]
                        }
                    }
                ]
            };
        },
        methods: {
            getStatusTagType(status) {
                const types = {
                    '待付款': 'warning',
                    '待发货': 'danger',
                    '已发货': 'primary',
                    '已完成': 'success',
                    '已取消': 'info'
                };
                return types[status] || '';
            },
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewOrder(order) {
                this.$alert(`<div>
                    <p><strong>订单编号：</strong>${order.orderNumber}</p>
                    <p><strong>下单时间：</strong>${order.createTime}</p>
                    <p><strong>买家信息：</strong>${order.buyer} (${order.buyerPhone})</p>
                    <p><strong>订单金额：</strong>¥${order.totalPrice}</p>
                    <p><strong>订单状态：</strong>${order.status}</p>
                    <p><strong>商品列表：</strong></p>
                    <ul>
                        ${order.products.map(p => `<li>${p.name} - ¥${p.price} × ${p.quantity}</li>`).join('')}
                    </ul>
                </div>`, '订单详情', {
                    dangerouslyUseHTMLString: true,
                    customClass: 'order-detail-alert'
                });
            },
            shipOrder(order) {
                this.$prompt('请输入快递单号', '发货操作', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    inputPlaceholder: '请输入快递单号',
                    inputValidator: (value) => {
                        if (!value) {
                            return '快递单号不能为空';
                        }
                    }
                }).then(({ value }) => {
                    this.$prompt('请选择物流公司', '发货操作', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        inputPlaceholder: '请选择物流公司',
                        inputValue: '顺丰速运',
                        inputPattern: /.+/,
                        inputErrorMessage: '请选择物流公司'
                    }).then(({ value: company }) => {
                        order.status = '已发货';
                        order.logisticsInfo.expressCompany = company;
                        order.logisticsInfo.expressNumber = value;
                        order.logisticsInfo.status = '运输中';
                        order.logisticsInfo.timeline.push({
                            time: new Date().toLocaleString(),
                            status: '已发货',
                            location: '杭州',
                            lnglat: [120.15507, 30.274085]
                        });
                        this.$message.success('订单已发货');
                    }).catch(() => {});
                }).catch(() => {});
            },
            viewLogistics(order) {
                this.$emit('view-logistics', order.logisticsInfo);
            }
        }
    };

    // 待处理订单组件
    const PendingOrders = {
        template: `
          <div>
            <h2>待处理订单</h2>
            <el-table :data="pendingOrders" style="width: 100%" border>
              <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
              <el-table-column label="商品信息" width="300">
                <template slot-scope="scope">
                  <div v-for="(product, index) in scope.row.products" :key="index" style="margin-bottom: 5px;">
                    <img :src="product.image" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; float: left; margin-right: 10px;">
                    <div style="float: left;">
                      <div>{{ product.name }}</div>
                      <div style="font-size: 12px; color: #999;">¥ {{ product.price }} × {{ product.quantity }}</div>
                    </div>
                    <div style="clear: both;"></div>
                  </div>
                </template>
              </el-table-column>
              <el-table-column label="订单金额" width="120">
                <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
              </el-table-column>
              <el-table-column label="买家信息" width="150">
                <template slot-scope="scope">
                  <div>{{ scope.row.buyer }}</div>
                  <div style="font-size: 12px; color: #999;">{{ scope.row.buyerPhone }}</div>
                </template>
              </el-table-column>
              <el-table-column label="下单时间" width="180">
                <template slot-scope="scope">{{ scope.row.createTime }}</template>
              </el-table-column>
              <el-table-column label="操作" width="180">
                <template slot-scope="scope">
                  <div class="button-group">
                    <el-button size="small" type="primary" @click="viewOrder(scope.row)">详情</el-button>
                    <el-button size="small" type="success" @click="shipOrder(scope.row)">发货</el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="pendingOrders.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                pendingOrders: [
                    {
                        orderNumber: '20250615001',
                        products: [
                            { name: '有机西红柿', price: 12.8, quantity: 2, image: '/static/img/tomato.png' },
                            { name: '新鲜菠菜', price: 6.5, quantity: 1, image: '/static/img/spinach.png' }
                        ],
                        totalPrice: 32.1,
                        buyer: '张先生',
                        buyerPhone: '138****1234',
                        status: '待发货',
                        createTime: '2025-06-15 10:30:22',
                        logisticsInfo: {
                            expressCompany: '',
                            expressNumber: '',
                            status: '待发货',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '上海市浦东新区张江高科技园区科苑路88号',
                            timeline: []
                        }
                    }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewOrder(order) {
                this.$alert(`<div>
                    <p><strong>订单编号：</strong>${order.orderNumber}</p>
                    <p><strong>下单时间：</strong>${order.createTime}</p>
                    <p><strong>买家信息：</strong>${order.buyer} (${order.buyerPhone})</p>
                    <p><strong>订单金额：</strong>¥${order.totalPrice}</p>
                    <p><strong>商品列表：</strong></p>
                    <ul>
                        ${order.products.map(p => `<li>${p.name} - ¥${p.price} × ${p.quantity}</li>`).join('')}
                    </ul>
                </div>`, '订单详情', {
                    dangerouslyUseHTMLString: true,
                    customClass: 'order-detail-alert'
                });
            },
            shipOrder(order) {
                this.$prompt('请输入快递单号', '发货操作', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    inputPlaceholder: '请输入快递单号',
                    inputValidator: (value) => {
                        if (!value) {
                            return '快递单号不能为空';
                        }
                    }
                }).then(({ value }) => {
                    this.$prompt('请选择物流公司', '发货操作', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        inputPlaceholder: '请选择物流公司',
                        inputValue: '顺丰速运',
                        inputPattern: /.+/,
                        inputErrorMessage: '请选择物流公司'
                    }).then(({ value: company }) => {
                        order.status = '已发货';
                        order.logisticsInfo.expressCompany = company;
                        order.logisticsInfo.expressNumber = value;
                        order.logisticsInfo.status = '运输中';
                        order.logisticsInfo.timeline.push({
                            time: new Date().toLocaleString(),
                            status: '已发货',
                            location: '杭州',
                            lnglat: [120.15507, 30.274085]
                        });
                        this.$message.success('订单已发货');
                        this.pendingOrders = this.pendingOrders.filter(o => o.orderNumber !== order.orderNumber);
                    }).catch(() => {});
                }).catch(() => {});
            }
        }
    };

    // 已完成订单组件
    const CompletedOrders = {
        template: `
          <div>
            <h2>已完成订单</h2>
            <div class="button-group">
              <el-button type="primary" icon="el-icon-search">搜索订单</el-button>
              <el-button type="info" icon="el-icon-refresh">刷新列表</el-button>
              <el-date-picker
                  v-model="dateRange"
                  type="daterange"
                  align="right"
                  unlink-panels
                  range-separator="至"
                  start-placeholder="开始日期"
                  end-placeholder="结束日期"
                  :picker-options="pickerOptions">
              </el-date-picker>
            </div>
            <el-table :data="completedOrders" style="width: 100%" border>
              <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
              <el-table-column label="商品信息" width="300">
                <template slot-scope="scope">
                  <div v-for="(product, index) in scope.row.products" :key="index" style="margin-bottom: 5px;">
                    <img :src="product.image" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; float: left; margin-right: 10px;">
                    <div style="float: left;">
                      <div>{{ product.name }}</div>
                      <div style="font-size: 12px; color: #999;">¥ {{ product.price }} × {{ product.quantity }}</div>
                    </div>
                    <div style="clear: both;"></div>
                  </div>
                </template>
              </el-table-column>
              <el-table-column label="订单金额" width="120">
                <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
              </el-table-column>
              <el-table-column label="买家信息" width="150">
                <template slot-scope="scope">
                  <div>{{ scope.row.buyer }}</div>
                  <div style="font-size: 12px; color: #999;">{{ scope.row.buyerPhone }}</div>
                </template>
              </el-table-column>
              <el-table-column label="完成时间" width="180">
                <template slot-scope="scope">{{ scope.row.completeTime }}</template>
              </el-table-column>
              <el-table-column label="操作" width="180">
                <template slot-scope="scope">
                  <div class="button-group">
                    <el-button size="small" type="primary" @click="viewOrder(scope.row)">详情</el-button>
                    <el-button size="small" type="info" @click="viewLogistics(scope.row)">物流</el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="completedOrders.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                dateRange: [],
                pickerOptions: {
                    shortcuts: [{
                        text: '最近一周',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近一个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近三个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                            picker.$emit('pick', [start, end]);
                        }
                    }]
                },
                completedOrders: [
                    {
                        orderNumber: '20250612003',
                        products: [
                            { name: '农家土鸡蛋', price: 1.5, quantity: 30, image: '/static/img/egg.png' },
                            { name: '五常大米', price: 89.9, quantity: 1, image: '/static/img/rice.png' }
                        ],
                        totalPrice: 134.9,
                        buyer: '王先生',
                        buyerPhone: '137****9012',
                        completeTime: '2025-06-13 16:30:00',
                        logisticsInfo: {
                            expressCompany: '中通快递',
                            expressNumber: 'ZT1234567890123',
                            status: '已签收',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '广东省深圳市南山区科技园路1号',
                            timeline: [
                                { time: '2025-06-12 10:15:00', status: '已揽收', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-12 15:45:00', status: '已发往深圳中转中心', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-13 09:20:00', status: '到达深圳中转中心', location: '深圳', lnglat: [114.057868, 22.543099] },
                                { time: '2025-06-13 14:10:00', status: '派送中', location: '深圳', lnglat: [114.057868, 22.543099] },
                                { time: '2025-06-13 16:30:00', status: '已签收', location: '深圳', lnglat: [114.057868, 22.543099] }
                            ]
                        }
                    }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewOrder(order) {
                this.$alert(`<div>
                    <p><strong>订单编号：</strong>${order.orderNumber}</p>
                    <p><strong>完成时间：</strong>${order.completeTime}</p>
                    <p><strong>买家信息：</strong>${order.buyer} (${order.buyerPhone})</p>
                    <p><strong>订单金额：</strong>¥${order.totalPrice}</p>
                    <p><strong>商品列表：</strong></p>
                    <ul>
                        ${order.products.map(p => `<li>${p.name} - ¥${p.price} × ${p.quantity}</li>`).join('')}
                    </ul>
                </div>`, '订单详情', {
                    dangerouslyUseHTMLString: true,
                    customClass: 'order-detail-alert'
                });
            },
            viewLogistics(order) {
                this.$emit('view-logistics', order.logisticsInfo);
            }
        }
    };

    // 待发货订单组件
    const ToShip = {
        template: `
          <div>
            <h2>待发货订单</h2>
            <el-table :data="toShipOrders" style="width: 100%" border>
              <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
              <el-table-column label="商品信息" width="300">
                <template slot-scope="scope">
                  <div v-for="(product, index) in scope.row.products" :key="index" style="margin-bottom: 5px;">
                    <img :src="product.image" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; float: left; margin-right: 10px;">
                    <div style="float: left;">
                      <div>{{ product.name }}</div>
                      <div style="font-size: 12px; color: #999;">¥ {{ product.price }} × {{ product.quantity }}</div>
                    </div>
                    <div style="clear: both;"></div>
                  </div>
                </template>
              </el-table-column>
              <el-table-column label="订单金额" width="120">
                <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
              </el-table-column>
              <el-table-column label="买家信息" width="150">
                <template slot-scope="scope">
                  <div>{{ scope.row.buyer }}</div>
                  <div style="font-size: 12px; color: #999;">{{ scope.row.buyerPhone }}</div>
                </template>
              </el-table-column>
              <el-table-column label="下单时间" width="180">
                <template slot-scope="scope">{{ scope.row.createTime }}</template>
              </el-table-column>
              <el-table-column label="操作" width="180">
                <template slot-scope="scope">
                  <div class="button-group">
                    <el-button size="small" type="primary" @click="viewOrder(scope.row)">详情</el-button>
                    <el-button size="small" type="success" @click="shipOrder(scope.row)">发货</el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="toShipOrders.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                toShipOrders: [
                    {
                        orderNumber: '20250615001',
                        products: [
                            { name: '有机西红柿', price: 12.8, quantity: 2, image: '/static/img/tomato.png' },
                            { name: '新鲜菠菜', price: 6.5, quantity: 1, image: '/static/img/spinach.png' }
                        ],
                        totalPrice: 32.1,
                        buyer: '张先生',
                        buyerPhone: '138****1234',
                        createTime: '2025-06-15 10:30:22',
                        logisticsInfo: {
                            expressCompany: '',
                            expressNumber: '',
                            status: '待发货',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '上海市浦东新区张江高科技园区科苑路88号',
                            timeline: []
                        }
                    }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewOrder(order) {
                this.$alert(`<div>
                    <p><strong>订单编号：</strong>${order.orderNumber}</p>
                    <p><strong>下单时间：</strong>${order.createTime}</p>
                    <p><strong>买家信息：</strong>${order.buyer} (${order.buyerPhone})</p>
                    <p><strong>订单金额：</strong>¥${order.totalPrice}</p>
                    <p><strong>商品列表：</strong></p>
                    <ul>
                        ${order.products.map(p => `<li>${p.name} - ¥${p.price} × ${p.quantity}</li>`).join('')}
                    </ul>
                </div>`, '订单详情', {
                    dangerouslyUseHTMLString: true,
                    customClass: 'order-detail-alert'
                });
            },
            shipOrder(order) {
                this.$prompt('请输入快递单号', '发货操作', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    inputPlaceholder: '请输入快递单号',
                    inputValidator: (value) => {
                        if (!value) {
                            return '快递单号不能为空';
                        }
                    }
                }).then(({ value }) => {
                    this.$prompt('请选择物流公司', '发货操作', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        inputPlaceholder: '请选择物流公司',
                        inputValue: '顺丰速运',
                        inputPattern: /.+/,
                        inputErrorMessage: '请选择物流公司'
                    }).then(({ value: company }) => {
                        order.status = '已发货';
                        order.logisticsInfo.expressCompany = company;
                        order.logisticsInfo.expressNumber = value;
                        order.logisticsInfo.status = '运输中';
                        order.logisticsInfo.timeline.push({
                            time: new Date().toLocaleString(),
                            status: '已发货',
                            location: '杭州',
                            lnglat: [120.15507, 30.274085]
                        });
                        this.$message.success('订单已发货');
                        this.toShipOrders = this.toShipOrders.filter(o => o.orderNumber !== order.orderNumber);
                    }).catch(() => {});
                }).catch(() => {});
            }
        }
    };

    // 已发货订单组件
    const Shipped = {
        template: `
          <div>
            <h2>已发货订单</h2>
            <el-table :data="shippedOrders" style="width: 100%" border>
              <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
              <el-table-column label="物流公司" width="120">
                <template slot-scope="scope">{{ scope.row.logisticsInfo.expressCompany }}</template>
              </el-table-column>
              <el-table-column label="快递单号" width="180">
                <template slot-scope="scope">{{ scope.row.logisticsInfo.expressNumber }}</template>
              </el-table-column>
              <el-table-column label="买家信息" width="150">
                <template slot-scope="scope">
                  <div>{{ scope.row.buyer }}</div>
                  <div style="font-size: 12px; color: #999;">{{ scope.row.buyerPhone }}</div>
                </template>
              </el-table-column>
              <el-table-column label="物流状态" width="120">
                <template slot-scope="scope">
                  <el-tag :type="getStatusTagType(scope.row.logisticsInfo.status)">{{ scope.row.logisticsInfo.status }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column label="发货时间" width="180">
                <template slot-scope="scope">{{ scope.row.shipTime }}</template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="shippedOrders.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                shippedOrders: [
                    {
                        orderNumber: '20250614002',
                        products: [
                            { name: '红富士苹果', price: 8.5, quantity: 5, image: '/static/img/apple.png' }
                        ],
                        totalPrice: 42.5,
                        buyer: '李女士',
                        buyerPhone: '139****5678',
                        shipTime: '2025-06-14 16:30:00',
                        logisticsInfo: {
                            expressCompany: '#001',
                            expressNumber: 'SF1234567890123',
                            status: '运输中',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '北京市海淀区中关村南大街5号',
                            expectDate: '2025-06-18',
                            timeline: [
                                { time: '2025-06-14 16:30:00', status: '已揽收', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-14 18:15:00', status: '已发往北京中转中心', location: '杭州', lnglat: [120.15507, 30.274085] }
                            ]
                        }
                    }
                ]
            };
        },
        methods: {
            getStatusTagType(status) {
                const types = {
                    '运输中': 'primary',
                    '派送中': 'warning',
                    '已签收': 'success'
                };
                return types[status] || '';
            },
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            }
        }
    };

    // 已签收订单组件
    const Delivered = {
        template: `
          <div>
            <h2>已签收订单</h2>
            <el-table :data="deliveredOrders" style="width: 100%" border>
              <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
              <el-table-column label="物流公司" width="120">
                <template slot-scope="scope">{{ scope.row.logisticsInfo.expressCompany }}</template>
              </el-table-column>
              <el-table-column label="快递单号" width="180">
                <template slot-scope="scope">{{ scope.row.logisticsInfo.expressNumber }}</template>
              </el-table-column>
              <el-table-column label="买家信息" width="150">
                <template slot-scope="scope">
                  <div>{{ scope.row.buyer }}</div>
                  <div style="font-size: 12px; color: #999;">{{ scope.row.buyerPhone }}</div>
                </template>
              </el-table-column>
              <el-table-column label="签收时间" width="180">
                <template slot-scope="scope">{{ scope.row.deliveredTime }}</template>
              </el-table-column>
            </el-table>
            <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="currentPage"
                :page-sizes="[5, 10, 20]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="deliveredOrders.length">
            </el-pagination>
          </div>
        `,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                deliveredOrders: [
                    {
                        orderNumber: '20250612003',
                        products: [
                            { name: '农家土鸡蛋', price: 1.5, quantity: 30, image: '/static/img/egg.png' },
                            { name: '五常大米', price: 89.9, quantity: 1, image: '/static/img/rice.png' }
                        ],
                        totalPrice: 134.9,
                        buyer: '王先生',
                        buyerPhone: '137****9012',
                        deliveredTime: '2025-06-13 16:30:00',
                        logisticsInfo: {
                            expressCompany: '#002',
                            expressNumber: 'ZT1234567890123',
                            status: '已签收',
                            sender: '浙江省杭州市西湖区文三路123号',
                            receiver: '广东省深圳市南山区科技园路1号',
                            timeline: [
                                { time: '2025-06-12 10:15:00', status: '已揽收', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-12 15:45:00', status: '已发往深圳中转中心', location: '杭州', lnglat: [120.15507, 30.274085] },
                                { time: '2025-06-13 09:20:00', status: '到达深圳中转中心', location: '深圳', lnglat: [114.057868, 22.543099] },
                                { time: '2025-06-13 14:10:00', status: '派送中', location: '深圳', lnglat: [114.057868, 22.543099] },
                                { time: '2025-06-13 16:30:00', status: '已签收', location: '深圳', lnglat: [114.057868, 22.543099] }
                            ]
                        }
                    }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            }
        }
    };

    // 农户信息组件
    const FarmerInfo = {
        template: `
          <div>
            <h2>农户信息</h2>
            <el-form label-position="right" label-width="120px">
              <el-form-item label="农户名称">
                <el-input value="绿野农场" disabled></el-input>
              </el-form-item>
              <el-form-item label="联系人">
                <el-input value="张先生" disabled></el-input>
              </el-form-item>
              <el-form-item label="联系电话">
                <el-input value="13800001111" disabled></el-input>
              </el-form-item>
              <el-form-item label="农场地址">
                <el-input value="浙江省杭州市西湖区文三路123号" disabled></el-input>
              </el-form-item>
              <el-form-item label="农场面积">
                <el-input value="50亩" disabled></el-input>
              </el-form-item>
              <el-form-item label="主要产品">
                <el-input value="蔬菜、水果、禽蛋" disabled></el-input>
              </el-form-item>
              <el-form-item label="认证信息">
                <el-tag type="success">有机认证</el-tag>
                <el-tag type="success">绿色食品认证</el-tag>
              </el-form-item>
              <el-form-item label="注册时间">
                <el-input value="2023-05-10" disabled></el-input>
              </el-form-item>
              <div class="button-group">
                <el-button type="primary" @click="editInfo">编辑信息</el-button>
                <el-button type="success" @click="uploadCertification">上传认证</el-button>
              </div>
            </el-form>
          </div>
        `,
        methods: {
            editInfo() {
                alert('编辑农户信息');
            },
            uploadCertification() {
                alert('上传认证文件');
            }
        }
    };

    // 财务统计组件
    const Finance = {
        template: `
          <div>
            <h2>财务统计</h2>
            <el-row :gutter="20" style="margin-bottom: 20px;">
              <el-col :span="6">
                <el-card shadow="hover">
                  <div slot="header" class="clearfix">
                    <span>今日收入</span>
                  </div>
                  <div class="text item">
                    <h3 style="color: #67C23A; margin: 0;">¥ 1,256.80</h3>
                    <p style="color: #909399; font-size: 12px;">较昨日 <span style="color: #67C23A;">↑12.5%</span></p>
                  </div>
                </el-card>
              </el-col>
              <el-col :span="6">
                <el-card shadow="hover">
                  <div slot="header" class="clearfix">
                    <span>本月收入</span>
                  </div>
                  <div class="text item">
                    <h3 style="color: #67C23A; margin: 0;">¥ 28,945.30</h3>
                    <p style="color: #909399; font-size: 12px;">较上月 <span style="color: #67C23A;">↑8.2%</span></p>
                  </div>
                </el-card>
              </el-col>
              <el-col :span="6">
                <el-card shadow="hover">
                  <div slot="header" class="clearfix">
                    <span>本年收入</span>
                  </div>
                  <div class="text item">
                    <h3 style="color: #67C23A; margin: 0;">¥ 256,789.50</h3>
                    <p style="color: #909399; font-size: 12px;">较去年 <span style="color: #67C23A;">↑15.3%</span></p>
                  </div>
                </el-card>
              </el-col>
              <el-col :span="6">
                <el-card shadow="hover">
                  <div slot="header" class="clearfix">
                    <span>待结算金额</span>
                  </div>
                  <div class="text item">
                    <h3 style="color: #E6A23C; margin: 0;">¥ 5,678.20</h3>
                    <p style="color: #909399; font-size: 12px;">预计明天到账</p>
                  </div>
                </el-card>
              </el-col>
            </el-row>

            <el-card shadow="hover">
              <div slot="header" class="clearfix">
                <span>收入趋势</span>
                <div style="float: right;">
                  <el-select v-model="timeRange" placeholder="选择时间范围" size="small" style="width: 120px;">
                    <el-option label="近7天" value="7days"></el-option>
                    <el-option label="近30天" value="30days"></el-option>
                    <el-option label="近90天" value="90days"></el-option>
                    <el-option label="本年" value="year"></el-option>
                  </el-select>
                </div>
              </div>
              <div id="income-chart" style="height: 300px;"></div>
            </el-card>

            <el-card shadow="hover" style="margin-top: 20px;">
              <div slot="header" class="clearfix">
                <span>交易明细</span>
                <div style="float: right;">
                  <el-date-picker
                      v-model="transactionDateRange"
                      type="daterange"
                      align="right"
                      unlink-panels
                      range-separator="至"
                      start-placeholder="开始日期"
                      end-placeholder="结束日期"
                      :picker-options="pickerOptions"
                      size="small">
                  </el-date-picker>
                </div>
              </div>
              <el-table :data="transactions" style="width: 100%" border>
                <el-table-column prop="date" label="日期" width="120"></el-table-column>
                <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
                <el-table-column prop="product" label="商品" width="200"></el-table-column>
                <el-table-column prop="amount" label="金额" width="120">
                  <template slot-scope="scope">¥ {{ scope.row.amount }}</template>
                </el-table-column>
                <el-table-column prop="status" label="状态" width="120">
                  <template slot-scope="scope">
                    <el-tag :type="scope.row.status === '已结算' ? 'success' : 'warning'">{{ scope.row.status }}</el-tag>
                  </template>
                </el-table-column>
                <el-table-column label="操作" width="120">
                  <template slot-scope="scope">
                    <el-button size="small" type="text" @click="viewDetail(scope.row)">详情</el-button>
                  </template>
                </el-table-column>
              </el-table>
              <el-pagination
                  @size-change="handleTransactionSizeChange"
                  @current-change="handleTransactionCurrentChange"
                  :current-page="transactionCurrentPage"
                  :page-sizes="[5, 10, 20]"
                  :page-size="transactionPageSize"
                  layout="total, sizes, prev, pager, next, jumper"
                  :total="transactions.length">
              </el-pagination>
            </el-card>
          </div>
        `,
        data() {
            return {
                timeRange: '30days',
                transactionDateRange: [],
                pickerOptions: {
                    shortcuts: [{
                        text: '最近一周',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近一个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: '最近三个月',
                        onClick(picker) {
                            const end = new Date();
                            const start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                            picker.$emit('pick', [start, end]);
                        }
                    }]
                },
                transactionCurrentPage: 1,
                transactionPageSize: 10,
                transactions: [
                    { date: '2025-06-15', orderNumber: '20250615001', product: '有机西红柿 × 2, 新鲜菠菜 × 1', amount: 32.1, status: '已结算' },
                    { date: '2025-06-14', orderNumber: '20250614002', product: '红富士苹果 × 5', amount: 42.5, status: '已结算' },
                    { date: '2025-06-13', orderNumber: '20250613003', product: '农家土鸡蛋 × 30', amount: 45.0, status: '已结算' },
                    { date: '2025-06-12', orderNumber: '20250612004', product: '五常大米 × 1', amount: 89.9, status: '已结算' },
                    { date: '2025-06-11', orderNumber: '20250611005', product: '新鲜菠菜 × 3', amount: 19.5, status: '已结算' },
                    { date: '2025-06-10', orderNumber: '20250610006', product: '有机西红柿 × 5', amount: 64.0, status: '已结算' },
                    { date: '2025-06-09', orderNumber: '20250609007', product: '农家土鸡蛋 × 20', amount: 30.0, status: '已结算' },
                    { date: '2025-06-08', orderNumber: '20250608008', product: '红富士苹果 × 3', amount: 25.5, status: '已结算' },
                    { date: '2025-06-07', orderNumber: '20250607009', product: '五常大米 × 2', amount: 179.8, status: '已结算' },
                    { date: '2025-06-06', orderNumber: '20250606010', product: '新鲜菠菜 × 2', amount: 13.0, status: '待结算' }
                ]
            };
        },
        methods: {
            handleTransactionSizeChange(val) {
                this.transactionPageSize = val;
            },
            handleTransactionCurrentChange(val) {
                this.transactionCurrentPage = val;
            },
            viewDetail(row) {
                this.$alert(`<div>
                    <p><strong>订单编号：</strong>${row.orderNumber}</p>
                    <p><strong>交易日期：</strong>${row.date}</p>
                    <p><strong>商品信息：</strong>${row.product}</p>
                    <p><strong>交易金额：</strong>¥${row.amount}</p>
                    <p><strong>交易状态：</strong>${row.status}</p>
                </div>`, '交易详情', {
                    dangerouslyUseHTMLString: true
                });
            },
            initChart() {
                // 这里应该使用ECharts等图表库初始化图表
                // 示例代码省略实际图表初始化
                console.log('初始化收入趋势图表');
            }
        },
        mounted() {
            this.initChart();
        }
    };

    // 物流详情组件
    const LogisticsDetail = {
        template: `
          <div class="logistics-detail-container">
            <el-button class="back-button" type="primary" icon="el-icon-arrow-left" @click="handleBack">返回</el-button>
            <div class="logistics-header">
              <h2>物流详情</h2>
              <div class="logistics-info">
                <div class="logistics-company">
                  <p><strong>物流公司：</strong>{{ logisticsData.expressCompany }}</p>
                  <p><strong>快递单号：</strong>{{ logisticsData.expressNumber }}</p>
                  <p><strong>当前状态：</strong><span class="logistics-status">{{ logisticsData.status }}</span></p>
                </div>
                <div class="logistics-number">
                  <p><strong>发货地址：</strong>{{ logisticsData.sender }}</p>
                  <p><strong>收货地址：</strong>{{ logisticsData.receiver }}</p>
                  <p><strong>预计送达：</strong>{{ logisticsData.expectDate }}</p>
                </div>
              </div>
            </div>
            <h3>物流轨迹</h3>
            <div class="logistics-timeline">
              <div class="timeline-item" v-for="(item, index) in logisticsData.timeline" :key="index">
                <div class="timeline-time">{{ item.time }}</div>
                <div class="timeline-content">
                  {{ item.status }} - {{ item.location }}
                </div>
              </div>
            </div>
            <!-- 地图容器 -->
            <div class="logistics-map-container">
              <div class="logistics-map-title">物流地图</div>
              <div id="map-container"></div>
            </div>
          </div>
        `,
        props: {
            logisticsData: {
                type: Object,
                required: true
            }
        },
        data() {
            return {
                map: null
            };
        },
        mounted() {
            this.initMap();
        },
        methods: {
            handleBack() {
                this.$emit('back');
            },
            initMap() {
                // 初始化地图
                this.map = new AMap.Map('map-container', {
                    zoom: 5,  // 初始缩放级别
                    center: [116.404269, 39.915378]  // 初始中心点
                });
                // 添加物流轨迹点
                const markers = [];
                const path = [];
                // 为每个物流节点添加标记
                this.logisticsData.timeline.forEach((point, index) => {
                    if (point.lnglat) {
                        const marker = new AMap.Marker({
                            position: point.lnglat,
                            title: `${point.status} - ${point.location}`,
                            content: `<div style="background-color:#2e7d32;color:#fff;padding:2px 5px;border-radius:3px;">
                                      ${index + 1}. ${point.status}</div>`,
                            offset: new AMap.Pixel(-13, -30)
                        });
                        markers.push(marker);
                        path.push(point.lnglat);
                    }
                });
                // 添加标记到地图
                this.map.add(markers);
                // 如果有多个点，绘制物流路线
                if (path.length > 1) {
                    const polyline = new AMap.Polyline({
                        path: path,
                        isOutline: true,
                        outlineColor: '#ffeeff',
                        borderWeight: 1,
                        strokeColor: "#2e7d32",
                        strokeOpacity: 1,
                        strokeWeight: 3,
                        strokeStyle: "solid",
                        lineJoin: 'round',
                        lineCap: 'round'
                    });
                    this.map.add(polyline);
                }
                // 自动调整地图视野以显示所有标记
                if (markers.length > 0) {
                    this.map.setFitView();
                }
            }
        }
    };

    // Vue 实例
    new Vue({
        el: '#app',
        data() {
            return {
                currentComponent: 'my-products',
                showLogisticsDetail: false,
                currentLogistics: {},
                showAddProductDialogVisible: false,
                showEditProductDialogVisible: false,
                dialogImageUrl: '',
                dialogVisible: false,
                newProductForm: {
                    name: '',
                    category: '',
                    price: 0,
                    stock: 0,
                    unit: '',
                    image: '',
                    description: '',
                    origin: '',
                    shelfLife: ''
                },
                editProductForm: {
                    name: '',
                    category: '',
                    price: 0,
                    stock: 0,
                    unit: '',
                    image: '',
                    description: '',
                    origin: '',
                    shelfLife: ''
                },
                productRules: {
                    name: [{ required: true, message: '请输入商品名称', trigger: 'blur' }],
                    category: [{ required: true, message: '请选择商品分类', trigger: 'change' }],
                    price: [{ required: true, message: '请输入商品价格', trigger: 'blur' }],
                    stock: [{ required: true, message: '请输入库存数量', trigger: 'blur' }],
                    unit: [{ required: true, message: '请输入计量单位', trigger: 'blur' }]
                }
            };
        },
        components: {
            'my-products': MyProducts,
            'published-products': PublishedProducts,
            'add-product': {
                template: '<div></div>' // 空组件，实际通过对话框实现
            },
            'all-orders': AllOrders,
            'pending-orders': PendingOrders,
            'completed-orders': CompletedOrders,
            'to-ship': ToShip,
            'shipped': Shipped,
            'delivered': Delivered,
            'farmer-info': FarmerInfo,
            'finance': Finance,
            'logistics-detail': LogisticsDetail
        },
        methods: {
            async loadFarmerProducts() {
        const farmerId = localStorage.getItem('userId');
        const response = await axios.get(`http://localhost:8080/product/farmer/${farmerId}`);
        if (response.data.code === 200) {
            // 更新产品列表数据 (假设有products数组)
            this.products = response.data.data;
        }
    },
    async submitNewProduct() {
        this.newProductForm.farmerId = localStorage.getItem('userId'); // 添加farmerId
        const response = await axios.post('http://localhost:8080/product', this.newProductForm);
        if (response.data.code === 200) {
            this.$message.success('添加成功');
            this.showAddProductDialogVisible = false;
            this.loadFarmerProducts();
        }
    },
    async submitEditProduct() {
        const response = await axios.put(`http://localhost:8080/product/${this.editProductForm.id}`, this.editProductForm);
        if (response.data.code === 200) {
            this.$message.success('编辑成功');
            this.showEditProductDialogVisible = false;
            this.loadFarmerProducts();
        }
    },
    async loadOrders() {
        const farmerId = localStorage.getItem('userId');
        const response = await axios.get(`http://localhost:8080/order/farmer/${farmerId}`);
        if (response.data.code === 200) {
            // 更新订单列表 (假设有orders数组在组件)
            this.orders = response.data.data;
        }
    },
    async loadDrones() {
        const response = await axios.get('http://localhost:8080/drone/all');
        if (response.data.code === 200) {
            // 更新无人机列表
            this.drones = response.data.data;
        }
    },
    async registerDrone(droneForm) {
        const response = await axios.post('http://localhost:8080/drone', droneForm);
        if (response.data.code === 200) {
            alert('注册成功');
            this.loadDrones();
        }
    },
    async updateDroneStatus(id, status) {
        const response = await axios.put(`http://localhost:8080/drone/status/${id}`, null, { params: { status } });
        if (response.data.code === 200) {
            alert('更新成功');
            this.loadDrones();
        }
    }
            handleMenuSelect(index) {
                this.currentComponent = index;
                this.showLogisticsDetail = false;
            },
            showLogisticsDetail(logisticsData) {
                this.currentLogistics = logisticsData;
                this.showLogisticsDetail = true;
            },
            hideLogisticsDetail() {
                this.showLogisticsDetail = false;
            },
            showAddProductDialog() {
                this.newProductForm = {
                    name: '',
                    category: '',
                    price: 0,
                    stock: 0,
                    unit: '',
                    image: '',
                    description: '',
                    origin: '',
                    shelfLife: ''
                };
                this.showAddProductDialogVisible = true;
            },
            showEditProductDialog(product) {
                this.editProductForm = JSON.parse(JSON.stringify(product));
                this.showEditProductDialogVisible = true;
            },
            submitNewProduct() {
                this.$refs.newProductForm.validate((valid) => {
                    if (valid) {
                        // 模拟添加商品
                        const newId = 'p' + (100 + Math.floor(Math.random() * 900));
                        const newProduct = {
                            ...this.newProductForm,
                            id: newId,
                            status: '上架'
                        };
                        // 在实际应用中，这里应该调用API添加商品
                        this.$message.success('商品添加成功');
                        this.showAddProductDialogVisible = false;
                    } else {
                        return false;
                    }
                });
            },
            submitEditProduct() {
                this.$refs.editProductForm.validate((valid) => {
                    if (valid) {
                        // 模拟更新商品
                        // 在实际应用中，这里应该调用API更新商品
                        this.$message.success('商品信息更新成功');
                        this.showEditProductDialogVisible = false;
                    } else {
                        return false;
                    }
                });
            },
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePictureCardPreview(file) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            }
        },
        mounted() {
    this.loadFarmerProducts();
    this.loadOrders();
    this.loadDrones();
}
    });
</script>
</body>
</html>