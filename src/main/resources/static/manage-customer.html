<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>智农通农产品交易平台 - 个人中心</title>
    <!-- 引入 Element UI 样式 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">


    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            line-height: 1.6;
        }
        .el-header {
            background-color: white;
            color: #333;
            line-height: 60px;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo {
            display: flex;
            align-items: center;
        }
        .logo-icon {
            font-size: 32px;
            color: #2e7d32;
            margin-right: 10px;
        }
        .logo-text {
            font-size: 20px;
            font-weight: bold;
            color: #2e7d32;
        }
        nav ul {
            display: flex;
            list-style: none;
        }
        nav ul li {
            margin-left: 25px;
        }
        nav ul li a {
            text-decoration: none;
            color: #4a4a4a;
            font-weight: 500;
            font-size: 16px;
            transition: color 0.3s;
        }
        nav ul li a:hover {
            color: #2e7d32;
        }
        .el-aside {
            background-color: #f5f7fa;
            height: calc(100vh - 60px);
            overflow-y: auto;
            padding-top: 20px;
        }
        .content-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin: 20px;
        }
        .el-footer {
            background: linear-gradient(to right, #1b5e20, #2e7d32);
            color: white;
            text-align: center;
            line-height: 60px;
        }
        /* 按钮样式 */
        .el-button {
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .el-button:hover {
            background-color: #1b5e20;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(46, 125, 50, 0.4);
        }
        /* 表单输入框样式 */
        .el-input__inner {
            background-color: #f5f7fa;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
        }
        /* 按钮组样式 - 确保按钮对齐 */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;

        }
        .button-group .el-button {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            .el-header {
                flex-direction: column;
                text-align: center;
            }
            nav ul {
                margin-top: 10px;
                justify-content: center;
            }
        }
        /* 物流详情页面样式 */
        .logistics-detail-container {
            padding: 20px;
        }
        .logistics-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .logistics-info {
            display: flex;
            margin-bottom: 20px;
        }
        .logistics-company {
            flex: 1;
            padding-right: 20px;
        }
        .logistics-number {
            flex: 1;
        }
        .logistics-status {
            color: #2e7d32;
            font-weight: bold;
        }
        .logistics-timeline {
            margin: 30px 0;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
            padding-left: 30px;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            left: 6px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #2e7d32;
        }
        .timeline-item:after {
            content: '';
            position: absolute;
            left: 11px;
            top: 12px;
            width: 2px;
            height: 100%;
            background-color: #e0e0e0;
        }
        .timeline-item:last-child:after {
            display: none;
        }
        .timeline-time {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }
        .timeline-content {
            font-size: 16px;
        }
        .logistics-map-container {
            margin-top: 40px;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }
        .logistics-map-title {
            padding: 15px;
            background-color: #f5f7fa;
            border-bottom: 1px solid #eee;
            font-weight: bold;
        }
        /* 地图容器样式 */
        #map-container {
            height: 400px;
            width: 100%;
        }
        .back-button {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div id="app">
    <el-container style="height: 100vh;">
        <!-- 头部 -->
        <el-header class="el-header">
            <div class="logo">
                <i class="fas fa-leaf logo-icon"></i>
                <div>
                    <div class="logo-text">智农通</div>
                </div>
            </div>
            <nav>
                <ul>
                    <li><a href="/home-customer.html"><i class="fas fa-home"></i> 首页</a></li>
                    <li><a href="/home-customer.html"><i class="fas fa-apple-alt"></i> 农产品</a></li>
                    <li><a href="#"><i class="fas fa-tractor"></i> 供应商</a></li>
                    <li><a href="#"><i class="fas fa-info-circle"></i> 关于我们</a></li>
                    <li><a href="#"><i class="fas fa-phone"></i> 联系我们</a></li>
                </ul>
            </nav>
        </el-header>
        <!-- 主体容器 -->
        <el-container>
            <!-- 左侧菜单 -->
            <el-aside width="220px" class="el-aside">
                <el-menu default-active="basic-info" class="el-menu-vertical-demo" @select="handleMenuSelect">
                    <el-submenu index="1">
                        <template slot="title"><i class="el-icon-user"></i> 个人资料</template>
                        <el-menu-item index="basic-info">基本信息</el-menu-item>
<!--                        <el-menu-item index="change-password">安全设置</el-menu-item>-->
                    </el-submenu>
                    <el-menu-item index="favorite"><i class="el-icon-star-on"></i> 商品收藏</el-menu-item>
                    <!-- 已删除：关注店铺菜单项 <el-menu-item index="store-favorite"><i class="el-icon-star-on"></i> 关注店铺</el-menu-item> -->
                    <el-menu-item index="shopping-cart"><i class="el-icon-shopping-cart-1"></i> 购物清单</el-menu-item>
                    <el-submenu index="2">
                        <template slot="title"><i class="el-icon-truck"></i> 物流信息</template>
                        <el-menu-item index="not-shipped"><i class="el-icon-box"></i> 未发货</el-menu-item>
                        <el-menu-item index="to-receive"><i class="el-icon-loading"></i> 待收货</el-menu-item>
                        <el-menu-item index="received"><i class="el-icon-check"></i> 已收货</el-menu-item>
                    </el-submenu>
                </el-menu>
            </el-aside>
            <!-- 右侧内容区域 -->
            <el-main class="content-box">
                <component :is="currentComponent" @view-logistics="showLogisticsDetail"></component>
                <!-- 物流详情组件 -->
                <logistics-detail v-if="showDetail" :logistics-data="currentLogistics" @back="hideLogisticsDetail"></logistics-detail>
            </el-main>
        </el-container>
        <!-- 底部 -->
        <el-footer class="el-footer">
            © 2025 智农通农产品交易平台 版权所有
        </el-footer>
    </el-container>
</div>
<!-- 引入 Vue 和 Element UI -->
<script src="/static/element-ui/index.js"></script>
<!-- 组件定义 -->
<script>
    // 基本信息页面
    const BasicInfo = {
    data() {
        return {
            userForm: {
                name: '',
                phone: '',
                email: '',
                dress: '',  // 假设为 address，如果是 typo，改为 address
                registrationTime: '2024-01-15'
            }
        };
    },
        template: `
          <div>
            <h2>基本信息</h2>
            <p>这是你的个人信息页面。</p>
            <el-form label-position="right" label-width="120px" :model="userForm" ref="form" @submit.native.prevent="submitEdit">
              <el-form-item label="用户名" prop="name">
                <el-input v-model="userForm.name" disabled></el-input>
              </el-form-item>
              <el-form-item label="手机号" prop="phone">
                <el-input v-model="userForm.phone"></el-input>
              </el-form-item>
              <el-form-item label="邮箱" prop="email">
                <el-input v-model="userForm.email"></el-input>
              </el-form-item>
              <el-form-item label="地址" prop="dress">
                <el-input v-model="userForm.dress"></el-input>
              </el-form-item>
              <el-form-item label="注册时间">
                <el-input v-model="userForm.registrationTime" disabled></el-input>
              </el-form-item>
              <div class="button-group">
                <el-button type="primary" native-type="submit">编辑信息</el-button>
              </div>
            </el-form>
          </div>
        `,
        methods: {
        async submitEdit() {
            this.$refs.form.validate(async (valid) => {
                if (valid) {
                    const userId = localStorage.getItem('userId');
                    if (!userId) {
                        this.$message.error('请先登录');
                        return;
                    }
                    const updateData = {
                        phone: this.userForm.phone,
                        email: this.userForm.email,
                        address: this.userForm.dress
                    };
                    try {
                        const response = await axios.put(`http://localhost:8066/user/${userId}`, updateData);
                        if (response.data.code === 200) {
                            this.$message.success('更新成功');
                            // 新增：重新加载以显示最新数据（e.g., updateTime）
                            await this.loadUserInfo();
                        } else {
                            this.$message.error(response.data.msg);
                        }
                    } catch (error) {
                        this.$message.error('更新失败: ' + (error.response ? error.response.data.msg : error.message));
                    }
                }
            });
        },
        async loadUserInfo() {
            const userId = localStorage.getItem('userId');
            if (userId) {
                try {
                    const response = await axios.get(`http://localhost:8066/user/${userId}`);
                    if (response.data.code === 200) {
                        const data = response.data.data;
                        this.userForm.name = data.username;
                        this.userForm.phone = data.phone || '';
                        this.userForm.email = data.email || '';
                        this.userForm.dress = data.address || '';
                        this.userForm.registrationTime = data.createTime ? new Date(data.createTime).toLocaleDateString() : '';  // 格式化日期
                    }
                } catch (error) {
                    this.$message.error('加载失败');
                }
            }
        }
    },
    mounted() {
        this.loadUserInfo();
    }
};
    // 修改密码页面
    const ChangePassword = {
        template: `
          <div>
            <h2>修改密码</h2>
            <p>请填写旧密码并输入新密码：</p>
            <el-form :model="formData" :rules="rules" ref="passwordForm" label-width="120px">
              <el-form-item label="旧密码" prop="oldPassword">
                <el-input type="password" show-password v-model="formData.oldPassword"></el-input>
              </el-form-item>
              <el-form-item label="新密码" prop="newPassword">
                <el-input type="password" show-password v-model="formData.newPassword"></el-input>
              </el-form-item>
              <el-form-item label="确认密码" prop="confirmPassword">
                <el-input type="password" show-password v-model="formData.confirmPassword"></el-input>
              </el-form-item>
              <div class="button-group">
                <el-button type="primary" @click="submit">提交</el-button>
              </div>
            </el-form>
          </div>
        `,
        data() {
            return {
                formData: {
                    oldPassword: '',
                    newPassword: '',
                    confirmPassword: ''
                },
                rules: {
                    oldPassword: [
                        { required: true, message: '请输入旧密码', trigger: 'blur' }
                    ],
                    newPassword: [
                        { required: true, message: '请输入新密码', trigger: 'blur' },
                        { min: 6, message: '密码长度至少为6位', trigger: 'blur' }
                    ],
                    confirmPassword: [
                        { required: true, message: '请确认新密码', trigger: 'blur' },
                        { validator: this.validatePassword, trigger: 'blur' }
                    ]
                }
            };
        },
        methods: {
            validatePassword(rule, value, callback) {
                if (value !== this.formData.newPassword) {
                    callback(new Error('两次输入的密码不一致'));
                } else {
                    callback();
                }
            },
            submit() {
                this.$refs.passwordForm.validate((valid) => {
                    if (valid) {
                        alert('密码修改成功');
                        this.formData = {
                            oldPassword: '',
                            newPassword: '',
                            confirmPassword: ''
                        };
                    } else {
                        return false;
                    }
                });
            }
        }
    };
    // 商品收藏页面
    const Favorite = {
        template: `<div>
          <h2>商品收藏</h2>
          <el-input v-model="search" placeholder="搜索收藏商品" prefix-icon="el-icon-search" style="width: 300px; margin-bottom: 20px;"></el-input>
          <el-table
              :data="tableData.filter(data => !search || data.name.toLowerCase().includes(search.toLowerCase()))"
              style="width: 100%">
            <el-table-column prop="id" label="ID" width="80"></el-table-column>
            <el-table-column label="商品图片" width="100">
              <template slot-scope="scope">
                <img :src="scope.row.image" alt="商品图片" style="width: 80px; height: 80px; object-fit: cover; border-radius: 4px;">
              </template>
            </el-table-column>
            <el-table-column prop="name" label="商品名称"></el-table-column>
            <el-table-column prop="price" label="价格" width="100">
              <template slot-scope="scope">¥ {{ scope.row.price }}</template>
            </el-table-column>
            <el-table-column prop="status" label="状态" width="100">
              <template slot-scope="scope">
                <el-tag :type="scope.row.status === '在售' ? 'success' : 'info'">{{ scope.row.status }}</el-tag>
              </template>
            </el-table-column>
            <el-table-column label="操作" width="180">
              <template slot-scope="scope">
                <div class="button-group">
                  <el-button size="small" type="primary" @click="viewDetail(scope.row)">查看详情</el-button>
                  <el-button size="small" type="danger" @click="removeFavorite(scope.row)">取消收藏</el-button>
                </div>
              </template>
            </el-table-column>
          </el-table>
          <el-pagination
              @size-change="handleSizeChange"
              @current-change="handleCurrentChange"
              :current-page="currentPage"
              :page-sizes="[5, 10, 20]"
              :page-size="pageSize"
              layout="total, sizes, prev, pager, next, jumper"
              :total="tableData.length">
          </el-pagination>
        </div>`,
        data() {
            return {
                search: '',
                currentPage: 1,
                pageSize: 10,
                tableData: [
                    { id: '1001', name: '有机绿色蔬菜组合', price: 49.9, status: '在售', image: '/img/veg.png' },
                    { id: '1002', name: '纯天然蜂蜜500g', price: 79.9, status: '在售', image: '/img/honey.webp' },
                    { id: '1003', name: '农家散养土鸡蛋30枚', price: 59.9, status: '在售', image: '/img/egg.jpg' },
                    { id: '1004', name: '新鲜草莓1kg', price: 39.9, status: '在售', image: '/img/strawberry.png' },
                    { id: '1005', name: '有机大米5kg', price: 89.9, status: '在售', image: '/img/rice.jpg' },
                    { id: '1006', name: '新鲜橙子5斤', price: 29.9, status: '预售', image: '/img/orange.v2' },
                    { id: '1007', name: '优质橄榄油500ml', price: 129.9, status: '在售', image: '/img/oil.v2' },
                    { id: '1008', name: '紫薯5斤装', price: 24.9, status: '在售', image: '/img/ps potato.jpg' }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewDetail(item) {
                console.log('查看商品详情', item);
                alert(`查看商品：${item.name}`);
            },
            removeFavorite(item) {
                this.$confirm('确定要取消收藏此商品吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    this.tableData = this.tableData.filter(row => row.id !== item.id);
                    this.$message({
                        type: 'success',
                        message: '已取消收藏'
                    });
                }).catch(() => {
                    // 取消操作
                });
            }
        }
    };
    // 购物清单页面
    const ShoppingCart = {
        template: `<div>
          <h2>购物清单</h2>
          <el-table
              :data="cartItems"
              style="width: 100%"
              border>
            <el-table-column type="selection" width="55"></el-table-column>
            <el-table-column label="商品信息" width="400">
              <template slot-scope="scope">
                <div class="cart-product">
                  <img :src="scope.row.image" alt="商品图片" style="width: 80px; height: 80px; object-fit: cover; border-radius: 4px; float: left; margin-right: 15px;">
                  <div>
                    <div class="cart-product-name">{{ scope.row.name }}</div>
                    <div class="cart-product-attr">{{ scope.row.attributes }}</div>
                  </div>
                </div>
              </template>
            </el-table-column>
            <el-table-column label="单价" width="120">
              <template slot-scope="scope">¥ {{ scope.row.price }}</template>
            </el-table-column>
            <el-table-column label="数量" width="180">
              <template slot-scope="scope">
                <el-input-number
                    v-model="scope.row.quantity"
                    :min="1"
                    :max="99"
                    size="small"
                    @change="handleQuantityChange(scope.row)"></el-input-number>
              </template>
            </el-table-column>
            <el-table-column label="小计" width="120">
              <template slot-scope="scope">¥ {{ scope.row.price * scope.row.quantity }}</template>
            </el-table-column>
            <el-table-column label="操作" width="100">
              <template slot-scope="scope">
                <div class="button-group">
                  <el-button size="small" type="danger" @click="removeItem(scope.row)">删除</el-button>
                </div>
              </template>
            </el-table-column>
          </el-table>
          <div class="cart-footer" style="margin-top: 20px; padding: 15px; background-color: #f5f7fa; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
            <div class="button-group">
              <el-button size="small" @click="selectAll">全选</el-button>
              <el-button size="small" @click="deleteSelected">删除选中</el-button>
            </div>
            <div>
              <span style="margin-right: 20px;">总计: <span class="cart-total-price">¥ {{ totalPrice }}</span></span>
              <el-button type="primary" size="medium" @click="checkout">结算 ({{ selectedCount }})</el-button>
            </div>
          </div>
        </div>`,
        data() {
            return {
                cartItems: [
                    { id: 'c001', name: '有机绿色蔬菜组合', price: 49.9, quantity: 1, attributes: '500g/份', image: '/img/veg.png', selected: true },
                    { id: 'c002', name: '纯天然蜂蜜500g', price: 79.9, quantity: 2, attributes: '瓶装', image: '/img/honey.webp', selected: true },
                    { id: 'c003', name: '农家散养土鸡蛋30枚', price: 59.9, quantity: 1, attributes: '礼盒装', image: '/img/egg.jpg', selected: false }
                ]
            };
        },
        computed: {
            totalPrice() {
                return this.cartItems
                    .filter(item => item.selected)
                    .reduce((total, item) => total + item.price * item.quantity, 0)
                    .toFixed(2);
            },
            selectedCount() {
                return this.cartItems.filter(item => item.selected).length;
            }
        },
        methods: {
            handleQuantityChange(item) {
                console.log('数量变化', item);
            },
            removeItem(item) {
                this.$confirm('确定要从购物车中移除该商品吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    this.cartItems = this.cartItems.filter(i => i.id !== item.id);
                    this.$message({
                        type: 'success',
                        message: '已从购物车移除'
                    });
                }).catch(() => {
                    // 取消操作
                });
            },
            selectAll() {
                const allSelected = this.cartItems.every(item => item.selected);
                this.cartItems.forEach(item => {
                    item.selected = !allSelected;
                });
            },
            deleteSelected() {
                const selectedItems = this.cartItems.filter(item => item.selected);
                if (selectedItems.length === 0) {
                    this.$message({
                        type: 'info',
                        message: '请先选择要删除的商品'
                    });
                    return;
                }
                this.$confirm('确定要删除选中的商品吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    this.cartItems = this.cartItems.filter(item => !item.selected);
                    this.$message({
                        type: 'success',
                        message: '已删除选中商品'
                    });
                }).catch(() => {
                    // 取消操作
                });
            },
            checkout() {
                const selectedItems = this.cartItems.filter(item => item.selected);
                if (selectedItems.length === 0) {
                    this.$message({
                        type: 'info',
                        message: '请先选择要结算的商品'
                    });
                    return;
                }
                this.$message({
                    type: 'success',
                    message: `结算 ${selectedItems.length} 件商品，总计 ¥${this.totalPrice}`
                });
            }
        }
    };
    // 未发货订单页面
    const NotShipped = {
        template: `<div>
          <h2>未发货订单</h2>
          <el-tabs v-model="activeTab">
            <el-tab-pane label="全部" name="all"></el-tab-pane>
          </el-tabs>
          <el-table
              :data="orders"
              style="width: 100%"
              border>
            <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
            <el-table-column label="商品信息" width="400">
              <template slot-scope="scope">
                <div class="order-product" v-for="(product, index) in scope.row.products" :key="index" style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                  <img :src="product.image" alt="商品图片" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; float: left; margin-right: 15px;">
                  <div>
                    <div class="order-product-name">{{ product.name }}</div>
                    <div class="order-product-attr">{{ product.attributes }}</div>
                    <div class="order-product-price">¥ {{ product.price }} × {{ product.quantity }}</div>
                  </div>
                </div>
              </template>
            </el-table-column>
            <el-table-column label="订单金额" width="120">
              <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
            </el-table-column>
            <el-table-column label="订单状态" width="120">
              <template slot-scope="scope">
                <el-tag :type="getStatusType(scope.row.status)">{{ scope.row.status }}</el-tag>
              </template>
            </el-table-column>
            <el-table-column label="操作" width="180">
              <template slot-scope="scope">
                <div class="button-group">
                  <el-button size="small" type="primary" @click="viewOrder(scope.row)">查看订单</el-button>
                  <el-button size="small" type="danger" v-if="scope.row.status === '待付款'" @click="cancelOrder(scope.row)">取消订单</el-button>
                  <el-button size="small" type="primary" v-if="scope.row.status === '待付款'" @click="payOrder(scope.row)">立即付款</el-button>
                </div>
              </template>
            </el-table-column>
          </el-table>
          <el-pagination
              @size-change="handleSizeChange"
              @current-change="handleCurrentChange"
              :current-page="currentPage"
              :page-sizes="[5, 10, 20]"
              :page-size="pageSize"
              layout="total, sizes, prev, pager, next, jumper"
              :total="orders.length">
          </el-pagination>
        </div>`,
        data() {
            return {
                activeTab: 'all',
                currentPage: 1,
                pageSize: 10,
                orders: [
                    {
                        orderNumber: '20250615001',
                        products: [
                            { name: '有机绿色蔬菜组合', price: 49.9, quantity: 2, attributes: '500g/份', image: '/img/veg.png' },
                            { name: '新鲜草莓1kg', price: 39.9, quantity: 1, attributes: '盒装', image: '/img/strawberry.png' }
                        ],
                        totalPrice: 139.7,
                        status: '待付款',
                        createTime: '2025-06-15 10:30:22'
                    },
                    {
                        orderNumber: '20250614002',
                        products: [
                            { name: '纯天然蜂蜜500g', price: 79.9, quantity: 1, attributes: '瓶装', image: '/img/honey.webp' },
                            { name: '优质橄榄油500ml', price: 129.9, quantity: 1, attributes: '礼盒装', image: '/img/oil.v2' }
                        ],
                        totalPrice: 209.8,
                        status: '已付款',
                        createTime: '2025-06-14 15:45:11'
                    },
                    {
                        orderNumber: '20250612003',
                        products: [
                            { name: '有机大米5kg', price: 89.9, quantity: 1, attributes: '袋装', image: '/img/rice.jpg' },
                            { name: '紫薯5斤装', price: 24.9, quantity: 2, attributes: '袋装', image: '/img/ps potato.jpg' }
                        ],
                        totalPrice: 139.7,
                        status: '已付款',
                        createTime: '2025-06-12 09:20:35'
                    }
                ]
            };
        },
        methods: {
            getStatusType(status) {
                switch (status) {
                    case '待付款':
                        return 'warning';
                    case '已付款':
                        return 'info';
                    default:
                        return 'primary';
                }
            },
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewOrder(order) {
                console.log('查看订单', order);
                alert(`查看订单：${order.orderNumber}`);
            },
            cancelOrder(order) {
                this.$confirm('确定要取消此订单吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    // 模拟取消订单
                    this.$message({
                        type: 'success',
                        message: '订单已取消'
                    });
                }).catch(() => {
                    // 取消操作
                });
            },
            payOrder(order) {
                console.log('支付订单', order);
                alert(`支付订单：${order.orderNumber}，金额：¥${order.totalPrice}`);
            }
        }
    };
    // 待收货订单页面
    const ToReceive = {
        template: `<div>
          <h2>待收货订单</h2>
          <el-table
              :data="orders"
              style="width: 100%"
              border>
            <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
            <el-table-column label="物流公司" width="120">
              <template slot-scope="scope">{{ scope.row.expressCompany }}</template>
            </el-table-column>
            <el-table-column label="快递单号" width="180">
              <template slot-scope="scope">{{ scope.row.expressNumber }}</template>
            </el-table-column>
            <el-table-column label="预计送达" width="150">
              <template slot-scope="scope">{{ scope.row.expectDate }}</template>
            </el-table-column>
            <el-table-column label="订单金额" width="120">
              <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
            </el-table-column>
            <el-table-column label="操作" width="120">
              <template slot-scope="scope">
                <div class="button-group">
                  <el-button size="small" type="success" @click="confirmReceive(scope.row)">确认收货</el-button>
                </div>
              </template>
            </el-table-column>
          </el-table>
          <el-pagination
              @size-change="handleSizeChange"
              @current-change="handleCurrentChange"
              :current-page="currentPage"
              :page-sizes="[5, 10, 20]"
              :page-size="pageSize"
              layout="total, sizes, prev, pager, next, jumper"
              :total="orders.length">
          </el-pagination>
        </div>`,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                orders: [
                    {
                        orderNumber: '20250610001',
                        expressCompany: '#001',
                        expressNumber: 'SF1234567890123',
                        expectDate: '2025-06-25',
                        totalPrice: 139.7,
                        status: '运输中'
                    },
                    {
                        orderNumber: '20250609002',
                        expressCompany: '#001',
                        expressNumber: 'JD1234567890123',
                        expectDate: '2025-06-24',
                        totalPrice: 209.8,
                        status: '派送中'
                    },
                    {
                        orderNumber: '20250608003',
                        expressCompany: '#002',
                        expressNumber: 'ZT1234567890123',
                        expectDate: '2025-06-23',
                        totalPrice: 139.7,
                        status: '已到达'
                    }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            confirmReceive(order) {
                this.$confirm('确定已收到商品并确认收货吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    // 模拟确认收货
                    this.$message({
                        type: 'success',
                        message: '已确认收货'
                    });
                }).catch(() => {
                    // 取消操作
                });
            }
        }
    };
    // 已收货订单页面
    const Received = {
        template: `<div>
          <h2>已收货订单</h2>
          <el-table
              :data="orders"
              style="width: 100%"
              border>
            <el-table-column prop="orderNumber" label="订单编号" width="180"></el-table-column>
            <el-table-column label="收货时间" width="150">
              <template slot-scope="scope">{{ scope.row.receiveDate }}</template>
            </el-table-column>
            <el-table-column label="订单金额" width="120">
              <template slot-scope="scope">¥ {{ scope.row.totalPrice }}</template>
            </el-table-column>
            <el-table-column label="订单状态" width="120">
              <template slot-scope="scope">
                <el-tag type="success">{{ scope.row.status }}</el-tag>
              </template>
            </el-table-column>
            <el-table-column label="操作" width="180">
              <template slot-scope="scope">
                <div class="button-group">
                  <el-button size="small" type="primary" @click="viewOrder(scope.row)">查看订单</el-button>
                  <el-button size="small" type="success" v-if="!scope.row.reviewed" @click="writeReview(scope.row)">评价商品</el-button>
                  <el-button size="small" type="info" v-if="scope.row.reviewed" @click="viewReview(scope.row)">查看评价</el-button>
                </div>
              </template>
            </el-table-column>
          </el-table>
          <el-pagination
              @size-change="handleSizeChange"
              @current-change="handleCurrentChange"
              :current-page="currentPage"
              :page-sizes="[5, 10, 20]"
              :page-size="pageSize"
              layout="total, sizes, prev, pager, next, jumper"
              :total="orders.length">
          </el-pagination>
        </div>`,
        data() {
            return {
                currentPage: 1,
                pageSize: 10,
                orders: [
                    {
                        orderNumber: '20250605001',
                        receiveDate: '2025-06-10',
                        totalPrice: 139.7,
                        status: '已完成',
                        reviewed: false
                    },
                    {
                        orderNumber: '20250603002',
                        receiveDate: '2025-06-08',
                        totalPrice: 209.8,
                        status: '已完成',
                        reviewed: true
                    },
                    {
                        orderNumber: '20250601003',
                        receiveDate: '2025-06-06',
                        totalPrice: 139.7,
                        status: '已完成',
                        reviewed: false
                    }
                ]
            };
        },
        methods: {
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            viewOrder(order) {
                console.log('查看订单', order);
                alert(`查看订单：${order.orderNumber}`);
            },
            writeReview(order) {
                console.log('写评价', order);
                alert(`为订单 ${order.orderNumber} 写评价`);
            },
            viewReview(order) {
                console.log('查看评价', order);
                alert(`查看订单 ${order.orderNumber} 的评价`);
            }
        }
    };
    // 物流详情组件
    const LogisticsDetail = {
        template: `
          <div class="logistics-detail-container">
            <el-button class="back-button" type="primary" icon="el-icon-arrow-left" @click="handleBack">返回</el-button>
            <div class="logistics-header">
              <h2>物流详情</h2>
              <div class="logistics-info">
                <div class="logistics-company">
                  <p><strong>物流公司：</strong>{{ logisticsData.expressCompany }}</p>
                  <p><strong>快递单号：</strong>{{ logisticsData.expressNumber }}</p>
                  <p><strong>当前状态：</strong><span class="logistics-status">{{ logisticsData.status }}</span></p>
                </div>
                <div class="logistics-number">
                  <p><strong>发货地址：</strong>{{ logisticsData.sender }}</p>
                  <p><strong>收货地址：</strong>{{ logisticsData.receiver }}</p>
                  <p><strong>预计送达：</strong>{{ logisticsData.expectDate }}</p>
                </div>
              </div>
            </div>
            <h3>物流轨迹</h3>
            <div class="logistics-timeline">
              <div class="timeline-item" v-for="(item, index) in logisticsData.timeline" :key="index">
                <div class="timeline-time">{{ item.time }}</div>
                <div class="timeline-content">
                  {{ item.status }} - {{ item.location }}
                </div>
              </div>
            </div>
            <!-- 地图容器 -->
            <div class="logistics-map-container">
              <div class="logistics-map-title">物流地图</div>
              <div id="map-container"></div>
            </div>
          </div>
        `,
        props: {
            logisticsData: {
                type: Object,
                required: true
            }
        },
        data() {
            return {
                map: null
            };
        },
        mounted() {
            this.initMap();
        },
        methods: {
            handleBack() {
                this.$emit('back');
            },
            initMap() {
                // 初始化地图
                this.map = new AMap.Map('map-container', {
                    zoom: 5,  // 初始缩放级别
                    center: [116.404269, 39.915378]  // 初始中心点
                });
                // 添加物流轨迹点
                const markers = [];
                const path = [];
                // 为每个物流节点添加标记
                this.logisticsData.timeline.forEach((point, index) => {
                    if (point.lnglat) {
                        const marker = new AMap.Marker({
                            position: point.lnglat,
                            title: `${point.status} - ${point.location}`,
                            content: `<div style="background-color:#2e7d32;color:#fff;padding:2px 5px;border-radius:3px;">
                                      ${index + 1}. ${point.status}</div>`,
                            offset: new AMap.Pixel(-13, -30)
                        });
                        markers.push(marker);
                        path.push(point.lnglat);
                    }
                });
                // 添加标记到地图
                this.map.add(markers);
                // 如果有多个点，绘制物流路线
                if (path.length > 1) {
                    const polyline = new AMap.Polyline({
                        path: path,
                        isOutline: true,
                        outlineColor: '#ffeeff',
                        borderWeight: 1,
                        strokeColor: "#2e7d32",
                        strokeOpacity: 1,
                        strokeWeight: 3,
                        strokeStyle: "solid",
                        lineJoin: 'round',
                        lineCap: 'round'
                    });
                    this.map.add(polyline);
                }
                // 自动调整地图视野以显示所有标记
                if (markers.length > 0) {
                    this.map.setFitView();
                }
            }
        }
    };
    new Vue({
    el: '#app',
    data() {
        return {
            currentComponent: 'basic-info',
            showDetail: false,
            currentLogistics: {}
        };
    },
    components: {
        'basic-info': BasicInfo,
        'change-password': ChangePassword,
        'favorite': Favorite,
        'shopping-cart': ShoppingCart,
        'not-shipped': NotShipped,
        'to-receive': ToReceive,
        'received': Received,
        'logistics-detail': LogisticsDetail
    },
    methods: {
        handleMenuSelect(index) {
            this.currentComponent = index;
            this.showDetail = false;
        },
        showLogisticsDetail(logisticsData) {
            this.currentLogistics = logisticsData;
            this.showDetail = true;
        },
        hideLogisticsDetail() {
            this.showDetail = false;
        },
        async loadUserInfo() {
            const userId = localStorage.getItem('userId');
            if (!userId) {
                alert('请先登录');
                //window.location.href = '/customer-login.html';
                return;
            }
            try {
                const response = await axios.get(`http://localhost:8066/user/${userId}`);  //
                if (response.data.code === 200) {
                    const userData = response.data.data;
                    this.$refs['basic-info'].userForm = {
                        name: userData.username || '',
                        phone: userData.phone || '',
                        email: userData.email || '',
                        dress: userData.address || '',
                        registrationTime: userData.createTime ? new Date(userData.createTime).toLocaleDateString() : ''
                    };
                } else {
                    alert('获取用户信息失败: ' + response.data.msg);
                }
            } catch (error) {
                alert('您的信息：');
                console.error(error);
            }
        }
    },
    mounted() {
        this.loadUserInfo();
    }
});
</script>
</body>
</html>