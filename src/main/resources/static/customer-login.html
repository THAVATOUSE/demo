<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <title>登录注册与物流信息</title>
    <!-- 引入 Element UI 的样式和 Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js "></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css ">
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab {
            cursor: pointer;
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #eee;
            border-radius: 5px;
        }

        .tab.active {
            background-color: #409EFF;
            color: white;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #409EFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .logistics-buttons {
            margin-top: 40px;
            text-align: right;
        }

        .logistics-buttons button {
            margin-left: 10px;
        }

        .map-image {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="app" class="container">
    <h1>欢迎来到我们的平台</h1>

    <!-- 登录/注册标签 -->
    <div class="tabs">
        <span class="tab" :class="{ active: activeTab === 'login' }" @click="activeTab = 'login'">登录</span>
        <span class="tab" :class="{ active: activeTab === 'register' }" @click="activeTab = 'register'">注册</span>
    </div>

    <!-- 登录表单 -->
    <form v-if="activeTab === 'login'">
        <input type="text" v-model="loginForm.identifier" placeholder="请输入用户名或邮箱" required>
        <input type="password" v-model="loginForm.password" placeholder="请输入密码" required>
        <button @click="login">登录</button>
    </form>

    <!-- 注册表单 -->
    <form v-if="activeTab === 'register'">
        <input type="text" v-model="registerForm.username" placeholder="请输入用户名" required>
        <input type="password" v-model="registerForm.password" placeholder="请输入密码" required>
        <input type="password" v-model="registerForm.confirmPassword" placeholder="确认密码" required>
        <input type="email" v-model="registerForm.email" placeholder="请输入邮箱" required>
        <input type="tel" v-model="registerForm.phone" placeholder="请输入电话" required>
        <button @click="register">注册</button>
    </form>

    <!-- 物流按钮 -->
    <div class="logistics-buttons">
        <el-button @click="showLogistics('not_shipped')">未发货</el-button>
        <el-button @click="showLogistics('in_transit')">待收货</el-button>
        <el-button @click="showLogistics('delivered')">已收货</el-button>
    </div>

    <!-- 浮窗 Dialog -->
    <el-dialog title="物流信息" :visible.sync="dialogVisible" width="30%">
        <p>{{ logisticsContent }}</p>
        <img :src="logisticsImage" alt="物流地图" class="map-image" v-if="logisticsImage">
    </el-dialog>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
    activeTab: 'login',
    loginForm: {
        identifier: '',  // 新: 用户名或邮箱
        password: ''
    },
    registerForm: {
        username: '',
        password: '',
        confirmPassword: '',
        email: '',
        phone: ''
    },
    logisticsContent: '',
    logisticsImage: '',
    dialogVisible: false
},
        methods: {
        showLogistics(status) {
            const logisticsData = {
                not_shipped: {
                    content: '您的订单尚未发货，请耐心等待。',
                    image: '/static/images/not_shipped_map.png'
                },
                in_transit: {
                    content: '您的包裹正在运输途中，请注意查收。',
                    image: '/static/images/in_transit_map.png'
                },
                delivered: {
                    content: '您的包裹已成功签收。感谢您的购买！',
                    image: '/static/images/delivered_map.png'
                }
            };

            const selected = logisticsData[status];
            if (selected) {
                this.logisticsContent = selected.content;
                this.logisticsImage = selected.image;
                this.dialogVisible = true;
            } else {
                this.logisticsContent = '无效的状态';
                this.logisticsImage = '';
                this.dialogVisible = true;
            }
        },
        // 新增：登录逻辑
        async login() {
        try {
            const response = await axios.post('http://localhost:8066/user/login', null, {  // 端口8066
                params: {
                    identifier: this.loginForm.identifier,
                    password: this.loginForm.password
                }
            });
            if (response.data.code === 200) {
                localStorage.setItem('userId', response.data.data.id);
                this.$message.success('登录成功');
                window.location.href = '/manage-customer.html';
            } else {
                this.$message.error(response.data.msg || '登录失败');
            }
        } catch (error) {
            this.$message.error('网络错误，请检查后端服务');
        }
    },
        // 新增：注册逻辑
        async register() {
            if (this.registerForm.password !== this.registerForm.confirmPassword) {
                this.$message.error('两次密码不一致！');
                return;
            }
            if (!this.registerForm.email.includes('@')) {  // 可选: 前端邮箱验证
               this.$message.error('邮箱格式无效！');
               return;
            }
            try {
                const response = await axios.post('http://localhost:8066/user/register', {
                    username: this.registerForm.username,
                    password: this.registerForm.password,
                    email: this.registerForm.email,
                    phone: this.registerForm.phone,
                    role: 'CUSTOMER'  // 固定为消费者角色
                });
                if (response.data.code === 200) {
                    localStorage.setItem('userId', response.data.data.id);  // 存储 userId
                    this.$message.success('注册成功，已自动登录');
                    window.location.href = '/manage-customer.html';  // 跳转到个人中心
                } else {
                    this.$message.error(response.data.msg || '注册失败');
                }
            } catch (error) {
                this.$message.error('网络错误，请检查后端服务');
            }
        }
    }
});
</script>

</body>
</html>